<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ë„ ìœ„, í•¨ê»˜ í†¡í†¡! (Tap Together on the Map!)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- í°íŠ¸: Noto Sans KR -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        #map { height: 100dvh; width: 100vw; z-index: 0; }
        .modal-overlay { z-index: 50; }
        .hud { z-index: 40; }
        .guessing-cursor { cursor: crosshair !important; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #c7c7cc; border-radius: 4px; }
        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ í† ê¸€ ìŠ¤íƒ€ì¼ */
        .toggle-checkbox:checked { right: 0; border-color: #22c55e; }
        .toggle-checkbox:checked + .toggle-label { background-color: #22c55e; }
    </style>
</head>
<body class="bg-gray-100 overflow-hidden relative">

    <!-- ë©”ì¸ ì§€ë„ ì˜ì—­ -->
    <div id="map"></div>

    <!-- ìƒë‹¨ HUD -->
    <div id="hud-top" class="hud absolute top-0 left-0 w-full p-2 sm:p-4 pointer-events-none hidden mt-12 sm:mt-0">
        <div class="flex flex-wrap justify-between items-start w-full gap-y-2 relative">
            <div class="bg-white/90 backdrop-blur-sm shadow-lg rounded-xl p-2 sm:p-4 pointer-events-auto border-2 border-green-500 w-auto">
                <h2 id="hud-player" class="text-xs sm:text-xl font-bold text-green-700 mb-1">1í”Œë ˆì´ì–´ ì°¨ë¡€</h2>
                <p id="hud-round" class="text-[10px] sm:text-sm text-gray-600">ë¼ìš´ë“œ: 1 / 3</p>
            </div>
            <div class="w-full sm:w-auto order-last sm:order-none sm:absolute sm:left-1/2 sm:-translate-x-1/2 flex justify-center pointer-events-none mt-1 sm:mt-0">
                <div class="bg-green-600 shadow-xl rounded-xl p-2 sm:p-4 pointer-events-auto text-center border-2 border-white transform hover:scale-105 transition-transform w-full sm:w-auto max-w-xs sm:max-w-md">
                    <p id="hud-target-intro" class="text-green-100 text-[10px] sm:text-sm font-semibold mb-1" data-i18n="targetIntro">ë‹¤ìŒ ì§€ì—­ì„ ì§€ë„ì—ì„œ ì°¾ìœ¼ì„¸ìš”!</p>
                    <h1 id="hud-target" class="text-lg sm:text-3xl font-bold text-white tracking-tight break-keep">ì „ë¼ë„</h1>
                </div>
            </div>
            <div id="hud-scores" class="bg-white/90 backdrop-blur-sm shadow-lg rounded-xl p-2 sm:p-4 pointer-events-auto min-w-[90px] sm:min-w-[150px] w-auto">
                <h3 class="text-[10px] sm:text-sm font-bold text-gray-800 border-b pb-1 sm:pb-2 mb-1 sm:mb-2" data-i18n="scoreBoard">ì ìˆ˜ í˜„í™©</h3>
                <ul id="score-list" class="space-y-1 text-[10px] sm:text-sm font-medium text-gray-700"></ul>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ì‹œì‘ í™”ë©´ (ëª¨ë°”ì¼ 1í™”ë©´ ìµœì í™” UI) -->
    <div id="modal-start" class="modal-overlay absolute inset-0 bg-black/60 flex justify-center items-center transition-opacity duration-300 py-4 px-3 sm:py-8 sm:px-0">
        <div class="bg-white rounded-2xl shadow-2xl p-4 sm:p-6 w-full max-w-md max-h-[95vh] overflow-y-auto flex flex-col relative">
            
            <!-- ì œëª© (ë…ë¦½ì ì¸ ì¤„ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ì–¸ì–´ë“  ê³µê°„ì„ ë„“ê²Œ ì“°ë„ë¡ í•¨) -->
            <h1 class="text-xl sm:text-3xl font-black text-gray-800 tracking-tight leading-tight break-keep mb-2" data-i18n="title">ì§€ë„ ìœ„, í•¨ê»˜ í†¡í†¡!</h1>
            
            <!-- ì €ì‘ì í‘œì‹œ ë° ì–¸ì–´ ì„ íƒ (ê°™ì€ ì¤„ ë°°ì¹˜) -->
            <div class="flex items-center justify-between flex-wrap gap-2 mb-4 w-full border-b border-gray-100 pb-3">
                <div class="flex items-center flex-wrap gap-1">
                    <span class="text-[11px] sm:text-xs font-bold text-indigo-600" data-i18n="author">ì €ì‘ì: Huh Byung doo</span>
                    <a href="mailto:wisefree@empas.com" class="text-[10px] sm:text-xs font-normal text-gray-500 hover:text-indigo-600 transition-colors bg-gray-100 px-2 py-0.5 rounded-full">(wisefree@empas.com)</a>
                </div>
                
                <!-- ì–¸ì–´ ì „í™˜ ì„ íƒì°½ (ì´ë©”ì¼ ìš°ì¸¡ìœ¼ë¡œ ì´ë™) -->
                <select id="lang-selector" class="shrink-0 bg-gray-100 px-2 py-1.5 rounded-lg text-[10px] sm:text-xs font-bold text-gray-700 shadow-sm border border-gray-200 hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 cursor-pointer text-center outline-none">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
                    <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
                    <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                </select>
            </div>
            
            <div class="space-y-3 text-left flex-1">
                <!-- ì°¸ì—¬ ì¸ì› ë° ë¼ìš´ë“œ -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-gray-700 mb-1" data-i18n="playerCount">ì°¸ì—¬ ì¸ì›</label>
                        <div class="flex space-x-1">
                            <button class="player-btn flex-1 py-1.5 rounded-lg border-2 border-green-600 bg-green-600 text-white font-bold transition-colors min-h-[40px]" data-players="1">1</button>
                            <button class="player-btn flex-1 py-1.5 rounded-lg border-2 border-gray-300 text-gray-600 hover:border-green-400 font-bold transition-colors min-h-[40px]" data-players="2">2</button>
                            <button class="player-btn flex-1 py-1.5 rounded-lg border-2 border-gray-300 text-gray-600 hover:border-green-400 font-bold transition-colors min-h-[40px]" data-players="3">3</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-700 mb-1" data-i18n="roundCount">ë¼ìš´ë“œ ìˆ˜</label>
                        <div class="flex space-x-1">
                            <button class="round-btn flex-1 py-1.5 rounded-lg border-2 border-green-600 bg-green-600 text-white font-bold transition-colors min-h-[40px]" data-rounds="3">3</button>
                            <button class="round-btn flex-1 py-1.5 rounded-lg border-2 border-gray-300 text-gray-600 hover:border-green-400 font-bold transition-colors min-h-[40px]" data-rounds="5">5</button>
                            <button class="round-btn flex-1 py-1.5 rounded-lg border-2 border-gray-300 text-gray-600 hover:border-green-400 font-bold transition-colors min-h-[40px]" data-rounds="10">10</button>
                        </div>
                    </div>
                </div>

                <!-- ëª…ì˜ˆì˜ ì „ë‹¹ í† ê¸€ -->
                <div class="bg-green-50 px-3 py-2 rounded-xl border border-green-100 flex items-center justify-between">
                    <span class="text-xs sm:text-sm font-bold text-green-800" data-i18n="recordScore">ì˜¤ëŠ˜ ëª…ì˜ˆì˜ ì „ë‹¹ ì ìˆ˜ ê¸°ë¡</span>
                    <div class="relative inline-block w-10 mr-1 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" id="record-score-toggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 border-gray-300 appearance-none cursor-pointer z-10 transition-transform duration-200 ease-in-out"/>
                        <label for="record-score-toggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
                <!-- ì´ë¦„ ì…ë ¥ -->
                <div id="name-inputs-container" class="hidden grid gap-1"></div>

                <!-- ë§‰ëŒ€ê·¸ë˜í”„í˜• ë‚œì´ë„ ì„¤ì • -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-1" data-i18n="diffSelect">ë‚œì´ë„ ì„ íƒ</label>
                    
                    <div class="flex items-end justify-between h-20 sm:h-24 gap-1.5 sm:gap-2 px-1 border-b-[3px] border-gray-300 pb-0 mt-2">
                        <button class="diff-btn flex-1 rounded-t-lg border-x-2 border-t-2 border-b-0 border-green-600 bg-green-500 text-white font-bold transition-all text-xs sm:text-sm flex items-center justify-center text-center shadow-md" style="height: 45%;" data-diff="beginner" data-i18n="diffBeginner">ì´ˆê¸‰</button>
                        <button class="diff-btn flex-1 rounded-t-lg border-x-2 border-t-2 border-b-0 border-gray-300 bg-gray-100 text-gray-500 font-bold transition-all text-xs sm:text-sm flex items-center justify-center text-center hover:bg-gray-200" style="height: 60%;" data-diff="intermediate" data-i18n="diffIntermediate">ì¤‘ê¸‰</button>
                        <button class="diff-btn flex-1 rounded-t-lg border-x-2 border-t-2 border-b-0 border-gray-300 bg-gray-100 text-gray-500 font-bold transition-all text-xs sm:text-sm flex items-center justify-center text-center hover:bg-gray-200" style="height: 80%;" data-diff="advanced" data-i18n="diffAdvanced">ê³ ê¸‰</button>
                        <button class="diff-btn flex-1 rounded-t-lg border-x-2 border-t-2 border-b-0 border-gray-300 bg-gray-100 text-gray-500 font-bold transition-all text-xs sm:text-sm flex items-center justify-center text-center hover:bg-gray-200" style="height: 100%;" data-diff="expert" data-i18n="diffExpert">ìµœê³ ê¸‰</button>
                    </div>
                    
                    <button class="diff-btn w-full mt-3 py-2 rounded-lg border-2 border-dashed border-gray-300 text-gray-600 bg-white font-bold hover:bg-gray-50 transition-colors text-xs sm:text-sm min-h-[40px]" data-diff="community" id="btn-community-diff" data-i18n="diffCommunity">ğŸŒ ëª¨ë‘ê°€ í•¨ê»˜ ë§Œë“  ì½”ìŠ¤</button>
                    <p id="diff-desc" class="text-[11px] text-gray-500 mt-2 text-center leading-tight break-keep" data-i18n="diffDescBeginner">ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ê°€ ë„“ìŠµë‹ˆë‹¤. ì§€ì—­ì´ë‚˜ êµ­ê°€ ê·¼ì²˜ë§Œ ì°ì–´ë„ ë†’ì€ ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>

            <button id="btn-start-game" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-transform hover:-translate-y-1 text-base sm:text-lg min-h-[50px]" data-i18n="btnStart">íƒí—˜ ì‹œì‘í•˜ê¸°</button>

            <!-- ë¦¬ë”ë³´ë“œ -->
            <div class="mt-4 border-t border-gray-100 pt-3">
                <h3 class="text-xs sm:text-sm font-bold text-gray-600 mb-2 flex items-center justify-center" data-i18n="leaderboardTitle">
                    <span class="text-yellow-500 mr-1">ğŸ†</span> ì˜¤ëŠ˜ ë‹¬ì„±í•œ ìµœê³  ì ìˆ˜ (Top 3)
                </h3>
                <ul id="leaderboard-list" class="space-y-1 text-xs sm:text-sm">
                    <li class="text-gray-400 text-center py-1 text-xs" data-i18n="leaderboardLoading">ìˆœìœ„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ì°¨ë¡€ ì•Œë¦¼ -->
    <div id="modal-turn" class="modal-overlay absolute inset-0 bg-black/50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-sm w-full text-center mx-4">
            <h2 id="turn-player-text" class="text-xl sm:text-2xl font-bold text-green-600 mb-2 sm:mb-4">1í”Œë ˆì´ì–´ ì¤€ë¹„!</h2>
            <p class="text-sm sm:text-base text-gray-600 mb-4 sm:mb-6" data-i18n="turnSubtitle">ë‹¤ìŒ ì§€ì—­ì„ ì°¾ì„ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?</p>
            <h3 id="turn-target-text" class="text-2xl sm:text-3xl font-black text-gray-800 mb-6 sm:mb-8 bg-gray-100 py-4 rounded-xl break-keep">ì „ë¼ë„</h3>
            <button id="btn-ready" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-colors" data-i18n="btnReady">í™•ì¸ (ì§€ë„ ë³´ê¸°)</button>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ê²°ê³¼ ë°œí‘œ -->
    <div id="modal-result" class="modal-overlay absolute inset-0 bg-black/40 hidden flex items-center justify-end p-4 sm:p-8 pb-8 sm:pb-12 flex-col pointer-events-none">
        <div class="bg-white rounded-2xl shadow-2xl p-5 sm:p-6 max-w-md w-full text-center pointer-events-auto mb-4 border-t-8 border-green-500">
            <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4" data-i18n="resultTitle">íƒìƒ‰ ê²°ê³¼</h2>
            <div class="flex justify-between items-center bg-gray-50 p-3 sm:p-4 rounded-xl mb-3 sm:mb-4 gap-2 sm:gap-4">
                <div class="text-left flex-1">
                    <p class="text-[10px] sm:text-sm text-gray-500 break-keep" data-i18n="resultDist">ì‹¤ì œ ìœ„ì¹˜ì™€ ë–¨ì–´ì§„ ê±°ë¦¬</p>
                    <p id="result-distance" class="text-lg sm:text-2xl font-black text-red-500 break-keep">150 km</p>
                </div>
                <div class="text-right">
                    <p class="text-[10px] sm:text-sm text-gray-500" data-i18n="resultScore">íšë“ ì ìˆ˜</p>
                    <p id="result-score" class="text-xl sm:text-2xl font-black text-green-600 whitespace-nowrap">8,500</p>
                </div>
            </div>
            <p id="result-msg" class="text-sm sm:text-base text-gray-600 font-medium mb-4 sm:mb-6 break-keep">ì•„ì£¼ í›Œë¥­í•©ë‹ˆë‹¤! ê±°ì˜ ì •í™•í•˜ê²Œ ì°¾ìœ¼ì…¨ë„¤ìš”.</p>
            <button id="btn-next-turn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-colors" data-i18n="btnNext">ë‹¤ìŒ ì°¨ë¡€ë¡œ</button>
        </div>
    </div>

    <!-- ëª¨ë‹¬: ìµœì¢… ê²°ê³¼ -->
    <div id="modal-final" class="modal-overlay absolute inset-0 bg-black/80 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center mx-4">
            <div class="mb-4 text-yellow-400">
                <svg class="w-16 h-16 sm:w-20 sm:h-20 mx-auto" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd"></path></svg>
            </div>
            <h1 class="text-2xl sm:text-3xl font-black text-gray-800 mb-2" data-i18n="gameEnd">íƒí—˜ ì¢…ë£Œ!</h1>
            <h2 id="final-winner" class="text-lg sm:text-xl font-bold text-green-600 mb-6 sm:mb-8 break-keep">1í”Œë ˆì´ì–´ê°€ ìš°ìŠ¹í–ˆìŠµë‹ˆë‹¤!</h2>
            <div id="final-scores-list" class="space-y-2 sm:space-y-3 mb-6 sm:mb-8 text-left"></div>
            <button id="btn-restart" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-4 rounded-xl shadow-md transition-colors" data-i18n="btnRestart">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- ë‹¤êµ­ì–´ ë”•ì…”ë„ˆë¦¬ (11ê°œ êµ­ì–´ ì§€ì›) ---
        const i18n = {
            ko: {
                title: "ì§€ë„ ìœ„, í•¨ê»˜ í†¡í†¡!",
                author: "ì €ì‘ì: Huh Byung doo",
                playerCount: "ì°¸ì—¬ ì¸ì›", recordScore: "ì˜¤ëŠ˜ ëª…ì˜ˆì˜ ì „ë‹¹ ì ìˆ˜ ê¸°ë¡", namePlaceholder: "ì´ë¦„ (ì•ˆ ì“°ë©´ 'ìµëª…')", roundCount: "ë¼ìš´ë“œ ìˆ˜",
                diffSelect: "ë‚œì´ë„ ì„ íƒ",
                diffBeginner: "ì´ˆê¸‰", diffIntermediate: "ì¤‘ê¸‰", diffAdvanced: "ê³ ê¸‰", diffExpert: "ìµœê³ ê¸‰", diffCommunity: "ğŸŒ ëª¨ë‘ê°€ í•¨ê»˜ ë§Œë“  ì½”ìŠ¤",
                diffDescBeginner: "ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ê°€ ë„“ìŠµë‹ˆë‹¤. ì§€ì—­ì´ë‚˜ êµ­ê°€ ê·¼ì²˜ë§Œ ì°ì–´ë„ ë†’ì€ ì ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.",
                diffDescInter: "ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ê°€ ë³´í†µì…ë‹ˆë‹¤. í•´ë‹¹ ë„ì‹œë‚˜ ì§€ì—­ ê·¼ë°©ì„ ì •í™•íˆ ë…¸ë ¤ì•¼ í•©ë‹ˆë‹¤.",
                diffDescAdv: "ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ê°€ ì¢ìŠµë‹ˆë‹¤. íŠ¹ì • ëœë“œë§ˆí¬ë‚˜ êµ¬/ë™ ë‹¨ìœ„ì˜ ì„¸ë°€í•œ ìœ„ì¹˜ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.",
                diffDescExpert: "ì˜¤ì°¨ í—ˆìš© ë²”ìœ„ê°€ ë§¤ìš° ì—„ê²©í•©ë‹ˆë‹¤. ì—­ì‚¬ì  ì¥ì†Œì˜ ì •í™•í•œ ì¢Œí‘œë¥¼ ì§šì–´ë‚´ì•¼ ìµœê³ ì ì„ ë°›ìŠµë‹ˆë‹¤.",
                diffDescComm: "ì „ ì„¸ê³„ íƒí—˜ê°€ë“¤ì´ ì§ì ‘ ì¶œì œí•˜ì—¬ í´ë¼ìš°ë“œì— ê³µìœ í•œ ë¬¸ì œì…ë‹ˆë‹¤!",
                btnStart: "íƒí—˜ ì‹œì‘í•˜ê¸°",
                leaderboardTitle: "ğŸ† ì˜¤ëŠ˜ ë‹¬ì„±í•œ ìµœê³  ì ìˆ˜ (Top 3)", leaderboardLoading: "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
                targetIntro: "ë‹¤ìŒ ì§€ì—­ì„ ì§€ë„ì—ì„œ ì°¾ìœ¼ì„¸ìš”!", scoreBoard: "ì ìˆ˜ í˜„í™©",
                resultTitle: "íƒìƒ‰ ê²°ê³¼", resultDist: "ì‹¤ì œ ìœ„ì¹˜ì™€ ë–¨ì–´ì§„ ê±°ë¦¬", resultScore: "íšë“ ì ìˆ˜", btnNext: "ë‹¤ìŒ ì°¨ë¡€ë¡œ",
                gameEnd: "íƒí—˜ ì¢…ë£Œ!", btnRestart: "ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°",
                turnSubtitle: "ë‹¤ìŒ ì§€ì—­ì„ ì°¾ì„ ì¤€ë¹„ê°€ ë˜ì…¨ë‚˜ìš”?", btnReady: "í™•ì¸ (ì§€ë„ ë³´ê¸°)",
                msgPerfect: "ì™„ë²½í•©ë‹ˆë‹¤! í•´ë‹¹ ì§€ì—­ ì•ˆì— ì •í™•í•˜ê²Œ ì°ìœ¼ì…¨ìŠµë‹ˆë‹¤!", msgExcellent: "ì•„ì£¼ í›Œë¥­í•©ë‹ˆë‹¤! ì •ë‹µ êµ¬ì—­ì— ë¬´ì²™ ê°€ê¹ê²Œ ì°ìœ¼ì…¨ë„¤ìš”.",
                msgGood: "í›Œë¥­í•©ë‹ˆë‹¤! ê½¤ ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì•Œê³  ê³„ì‹œêµ°ìš”.", msgOkay: "ì•„ì‰½ë„¤ìš”. ë°©í–¥ì€ ì–¼ì¶” ë¹„ìŠ·í–ˆìŠµë‹ˆë‹¤.",
                msgBad: "ë§ì´ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤. ë‹¤ìŒì—ëŠ” ë” ì‹ ì¤‘í•˜ê²Œ íƒí—˜í•´ ë³´ì„¸ìš”.", msgFail: "ì™„ì „íˆ ë‹¤ë¥¸ ê³³ì„ ì§šìœ¼ì…¨ìŠµë‹ˆë‹¤. ë¶„ë°œí•˜ì„¸ìš”!",
                distHit: "ì •ë‹µ êµ¬ì—­ ì ì¤‘! (ì¤‘ì‹¬ì—ì„œ",
                playerTurn: "ë‹˜ ì°¨ë¡€", playerReady: "ë‹˜ ì¤€ë¹„!", roundTxt: "ë¼ìš´ë“œ", winTxt: "ë‹˜ì´ ìš°ìŠ¹í–ˆìŠµë‹ˆë‹¤!",
                anon: "ìµëª…ì˜ íƒí—˜ê°€", myMark: "ë‚´ê°€ ì„ íƒí•œ ìœ„ì¹˜", realMark: "ì‹¤ì œ ì¤‘ì‹¬ ìœ„ì¹˜:"
            },
            en: {
                title: "Tap Together on the Map!", author: "Creator: Huh Byung doo",
                playerCount: "Players", recordScore: "Save to Hall of Fame", namePlaceholder: "Name (or 'Anon')", roundCount: "Rounds",
                diffSelect: "Difficulty", diffBeginner: "Beginner", diffIntermediate: "Intermediate", diffAdvanced: "Advanced", diffExpert: "Expert", diffCommunity: "ğŸŒ Community Courses",
                diffDescBeginner: "Generous margin of error. Click near the country/region.", diffDescInter: "Moderate margin of error. Aim for the specific city.", diffDescAdv: "Narrow margin of error. Find the specific landmark.", diffDescExpert: "Very strict. Pinpoint the exact historical coordinates.", diffDescComm: "Explore locations shared by players worldwide!",
                btnStart: "Start Exploring", leaderboardTitle: "ğŸ† Today's Top 3", leaderboardLoading: "Loading...",
                targetIntro: "Find this location on the map!", scoreBoard: "Scores", resultTitle: "Result", resultDist: "Distance missed", resultScore: "Score Acquired", btnNext: "Next Turn",
                gameEnd: "Finished!", btnRestart: "Back to Menu", turnSubtitle: "Ready to find the next location?", btnReady: "Ready (View Map)",
                msgPerfect: "Perfect! You clicked exactly within the area!", msgExcellent: "Excellent! Incredibly close.", msgGood: "Great! You have a good sense of location.", msgOkay: "Close, general direction is right.", msgBad: "Quite far off. Be more careful!", msgFail: "Completely off the mark. Keep trying!",
                distHit: "Area Hit! (From center:", playerTurn: "'s Turn", playerReady: " is Ready!", roundTxt: "Round", winTxt: " Wins!", anon: "Anonymous", myMark: "My Guess", realMark: "Actual Center:"
            },
            ja: {
                title: "åœ°å›³ã®ä¸Šã§ã€ä¸€ç·’ã«ãƒˆãƒ³ãƒˆãƒ³ï¼", author: "åˆ¶ä½œè€…: Huh Byung doo",
                playerCount: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼", recordScore: "æ®¿å ‚å…¥ã‚Šã‚¹ã‚³ã‚¢ã‚’è¨˜éŒ²", namePlaceholder: "åå‰ (æœªå…¥åŠ›ã¯åŒ¿å)", roundCount: "ãƒ©ã‚¦ãƒ³ãƒ‰",
                diffSelect: "é›£æ˜“åº¦", diffBeginner: "åˆç´š", diffIntermediate: "ä¸­ç´š", diffAdvanced: "ä¸Šç´š", diffExpert: "æœ€ä¸Šç´š", diffCommunity: "ğŸŒ ã¿ã‚“ãªã®ã‚³ãƒ¼ã‚¹",
                diffDescBeginner: "è¨±å®¹ç¯„å›²ãŒåºƒã„ã§ã™ã€‚å›½ã‚„åœ°åŸŸã®è¿‘ãã‚’ã‚¿ãƒƒãƒ—ã€‚", diffDescInter: "è¨±å®¹ç¯„å›²ã¯æ™®é€šã€‚è©²å½“ã™ã‚‹éƒ½å¸‚å‘¨è¾ºã‚’ç‹™ã„ã¾ã™ã€‚", diffDescAdv: "è¨±å®¹ç¯„å›²ãŒç‹­ã„ã€‚ç‰¹å®šã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚’æ¢ã—ã¾ã™ã€‚", diffDescExpert: "éå¸¸ã«å³ã—ã„ã€‚æ­´å²çš„ãªå ´æ‰€ã®æ­£ç¢ºãªåº§æ¨™ãŒå¿…è¦ã€‚", diffDescComm: "ä¸–ç•Œä¸­ã®äººãŒã‚¯ãƒ©ã‚¦ãƒ‰ã«å…±æœ‰ã—ãŸå•é¡Œã§ã™ï¼",
                btnStart: "æ¢æ¤œã‚’å§‹ã‚ã‚‹", leaderboardTitle: "ğŸ† ä»Šæ—¥ã®Top 3", leaderboardLoading: "èª­ã¿è¾¼ã¿ä¸­...",
                targetIntro: "æ¬¡ã®å ´æ‰€ã‚’æ¢ã—ã¦ãã ã•ã„ï¼", scoreBoard: "ã‚¹ã‚³ã‚¢", resultTitle: "çµæœ", resultDist: "å®Ÿéš›ã®å ´æ‰€ã‹ã‚‰ã®è·é›¢", resultScore: "ç²å¾—ã‚¹ã‚³ã‚¢", btnNext: "æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã¸",
                gameEnd: "æ¢æ¤œçµ‚äº†ï¼", btnRestart: "æœ€åˆã«æˆ»ã‚‹", turnSubtitle: "æ¬¡ã®å ´æ‰€ã‚’æ¢ã™æº–å‚™ã¯ã§ãã¾ã—ãŸã‹ï¼Ÿ", btnReady: "ç¢ºèª (åœ°å›³ã‚’è¦‹ã‚‹)",
                msgPerfect: "å®Œç’§ã§ã™ï¼å¯¾è±¡ã‚¨ãƒªã‚¢å†…ã«æ­£ç¢ºã«ã‚¿ãƒƒãƒ—ã—ã¾ã—ãŸï¼", msgExcellent: "ç´ æ™´ã‚‰ã—ã„ï¼æ­£è§£ã«ã¨ã¦ã‚‚è¿‘ã„ã§ã™ã€‚", msgGood: "ãŠè¦‹äº‹ï¼ã‹ãªã‚Šæ­£ç¢ºãªä½ç½®ã§ã™ã€‚", msgOkay: "æƒœã—ã„ã€‚æ–¹å‘ã¯åˆã£ã¦ã„ã¾ã—ãŸã€‚", msgBad: "ã‹ãªã‚Šå¤–ã‚Œã¾ã—ãŸã€‚æ¬¡ã¯æ…é‡ã«ã€‚", msgFail: "å…¨ãé•ã†å ´æ‰€ã§ã™ï¼",
                distHit: "æ­£è§£ã‚¨ãƒªã‚¢å‘½ä¸­ï¼ (ä¸­å¿ƒã‹ã‚‰", playerTurn: "ã®ã‚¿ãƒ¼ãƒ³", playerReady: "ã®æº–å‚™å®Œäº†ï¼", roundTxt: "ãƒ©ã‚¦ãƒ³ãƒ‰", winTxt: "ãŒå„ªå‹ã—ã¾ã—ãŸï¼", anon: "åŒ¿å", myMark: "ç§ã®é¸æŠ", realMark: "å®Ÿéš›ã®ä¸­å¿ƒ:"
            },
            zh: {
                title: "åœ°å›¾ä¸Šï¼Œä¸€èµ·ç‚¹ç‚¹ï¼", author: "åˆ›ä½œè€…: Huh Byung doo",
                playerCount: "å‚ä¸äººæ•°", recordScore: "è®°å½•åˆ†æ•°åˆ°åäººå ‚", namePlaceholder: "åå­— (ç•™ç©ºä¸ºåŒ¿å)", roundCount: "å›åˆæ•°",
                diffSelect: "éš¾åº¦", diffBeginner: "åˆçº§", diffIntermediate: "ä¸­çº§", diffAdvanced: "é«˜çº§", diffExpert: "ä¸“å®¶", diffCommunity: "ğŸŒ ç¤¾åŒºè·¯çº¿",
                diffDescBeginner: "è¯¯å·®èŒƒå›´å¤§ã€‚ç‚¹å‡»å›½å®¶/åœ°åŒºé™„è¿‘å³å¯è·å¾—é«˜åˆ†ã€‚", diffDescInter: "è¯¯å·®èŒƒå›´ä¸­ç­‰ã€‚è¯·ç„å‡†ç‰¹å®šåŸå¸‚æˆ–åœ°åŒºã€‚", diffDescAdv: "è¯¯å·®èŒƒå›´å°ã€‚éœ€è¦æ‰¾åˆ°ç‰¹å®šåœ°æ ‡æˆ–åŒºåŸŸã€‚", diffDescExpert: "éå¸¸ä¸¥æ ¼ã€‚å¿…é¡»æŒ‡å‡ºå†å²åèƒœçš„ç¡®åˆ‡åæ ‡ã€‚", diffDescComm: "æ¢ç´¢ä¸–ç•Œå„åœ°ç©å®¶å…±äº«çš„ä½ç½®ï¼",
                btnStart: "å¼€å§‹æ¢é™©", leaderboardTitle: "ğŸ† ä»Šæ—¥å‰ä¸‰å", leaderboardLoading: "åŠ è½½ä¸­...",
                targetIntro: "åœ¨åœ°å›¾ä¸Šæ‰¾åˆ°ä»¥ä¸‹ä½ç½®ï¼", scoreBoard: "å¾—åˆ†æ¿", resultTitle: "æ¢ç´¢ç»“æœ", resultDist: "åç¦»è·ç¦»", resultScore: "è·å¾—åˆ†æ•°", btnNext: "ä¸‹ä¸€å›åˆ",
                gameEnd: "æ¢é™©ç»“æŸï¼", btnRestart: "è¿”å›ä¸»èœå•", turnSubtitle: "å‡†å¤‡å¥½å¯»æ‰¾ä¸‹ä¸€ä¸ªä½ç½®äº†å—ï¼Ÿ", btnReady: "å‡†å¤‡ (æŸ¥çœ‹åœ°å›¾)",
                msgPerfect: "å®Œç¾ï¼æ‚¨å‡†ç¡®ç‚¹å‡»äº†è¯¥åŒºåŸŸï¼", msgExcellent: "å¤ªæ£’äº†ï¼ç¦»ç›®æ ‡éå¸¸è¿‘ã€‚", msgGood: "å¾ˆå¥½ï¼æ–¹å‘æ„Ÿä¸é”™ã€‚", msgOkay: "æœ‰ç‚¹åï¼Œä½†å¤§è‡´æ–¹å‘æ˜¯å¯¹çš„ã€‚", msgBad: "å·®å¾—æœ‰ç‚¹è¿œï¼Œä¸‹æ¬¡ä»”ç»†ç‚¹ï¼", msgFail: "å®Œå…¨åç¦»ç›®æ ‡ï¼Œç»§ç»­åŠªåŠ›ï¼",
                distHit: "å‘½ä¸­ç›®æ ‡åŒºåŸŸï¼(è·ä¸­å¿ƒï¼š", playerTurn: "çš„å›åˆ", playerReady: " å‡†å¤‡å°±ç»ªï¼", roundTxt: "å›åˆ", winTxt: " è·èƒœï¼", anon: "åŒ¿åæ¢é™©å®¶", myMark: "æˆ‘çš„çŒœæµ‹", realMark: "å®é™…ä¸­å¿ƒï¼š"
            },
            es: {
                title: "Â¡Toca Juntos en el Mapa!", author: "Creador: Huh Byung doo",
                playerCount: "Jugadores", recordScore: "Guardar PuntuaciÃ³n", namePlaceholder: "Nombre (o AnÃ³nimo)", roundCount: "Rondas",
                diffSelect: "Dificultad", diffBeginner: "FÃ¡cil", diffIntermediate: "Medio", diffAdvanced: "DifÃ­cil", diffExpert: "Experto", diffCommunity: "ğŸŒ Cursos Comunitarios",
                diffDescBeginner: "Margen de error amplio. Haz clic cerca del paÃ­s.", diffDescInter: "Margen moderado. Apunta a la ciudad especÃ­fica.", diffDescAdv: "Margen estrecho. Encuentra el lugar especÃ­fico.", diffDescExpert: "Muy estricto. SeÃ±ala las coordenadas exactas.", diffDescComm: "Â¡Explora lugares compartidos por jugadores!",
                btnStart: "Empezar", leaderboardTitle: "ğŸ† Top 3 de Hoy", leaderboardLoading: "Cargando...",
                targetIntro: "Â¡Encuentra este lugar en el mapa!", scoreBoard: "PuntuaciÃ³n", resultTitle: "Resultado", resultDist: "Distancia", resultScore: "Puntos", btnNext: "Siguiente Turno",
                gameEnd: "Â¡Terminado!", btnRestart: "Volver al MenÃº", turnSubtitle: "Â¿Listo para buscar?", btnReady: "Listo (Ver Mapa)",
                msgPerfect: "Â¡Perfecto! Â¡Le diste al Ã¡rea exacta!", msgExcellent: "Â¡Excelente! IncreÃ­blemente cerca.", msgGood: "Â¡Genial! Tienes buen sentido de la ubicaciÃ³n.", msgOkay: "Cerca, la direcciÃ³n general es correcta.", msgBad: "Bastante lejos. Â¡Ten mÃ¡s cuidado!", msgFail: "Totalmente desviado. Â¡Sigue intentando!",
                distHit: "Â¡Ãrea Acertada! (Desde el centro:", playerTurn: " (Turno)", playerReady: " Â¡Listo!", roundTxt: "Ronda", winTxt: " Â¡Gana!", anon: "AnÃ³nimo", myMark: "Mi ElecciÃ³n", realMark: "Centro Real:"
            },
            fr: {
                title: "Touchez Ensemble sur la Carte !", author: "CrÃ©ateur: Huh Byung doo",
                playerCount: "Joueurs", recordScore: "Sauvegarder le score", namePlaceholder: "Nom (ou Anonyme)", roundCount: "Tours",
                diffSelect: "DifficultÃ©", diffBeginner: "DÃ©butant", diffIntermediate: "IntermÃ©diaire", diffAdvanced: "AvancÃ©", diffExpert: "Expert", diffCommunity: "ğŸŒ Cours Communautaires",
                diffDescBeginner: "Marge d'erreur gÃ©nÃ©reuse. Cliquez prÃ¨s du pays/rÃ©gion.", diffDescInter: "Marge d'erreur modÃ©rÃ©e. Visez la ville spÃ©cifique.", diffDescAdv: "Marge d'erreur Ã©troite. Trouvez le point de repÃ¨re spÃ©cifique.", diffDescExpert: "TrÃ¨s strict. Identifiez les coordonnÃ©es exactes.", diffDescComm: "Explorez les lieux partagÃ©s par les joueurs du monde entier !",
                btnStart: "Commencer", leaderboardTitle: "ğŸ† Top 3 du Jour", leaderboardLoading: "Chargement...",
                targetIntro: "Trouvez cet endroit sur la carte !", scoreBoard: "Scores", resultTitle: "RÃ©sultat", resultDist: "Distance manquÃ©e", resultScore: "Score acquis", btnNext: "Tour suivant",
                gameEnd: "TerminÃ© !", btnRestart: "Retour au menu", turnSubtitle: "PrÃªt Ã  trouver le prochain lieu ?", btnReady: "PrÃªt (Voir la carte)",
                msgPerfect: "Parfait ! Vous avez cliquÃ© exactement dans la zone !", msgExcellent: "Excellent ! Incroyablement proche.", msgGood: "Super ! Vous avez un bon sens de l'orientation.", msgOkay: "Proche, la direction gÃ©nÃ©rale est bonne.", msgBad: "Assez loin. Soyez plus prudent !", msgFail: "ComplÃ¨tement Ã  cÃ´tÃ©. Continuez Ã  essayer !",
                distHit: "Zone touchÃ©e ! (Du centre :", playerTurn: " (Tour)", playerReady: " est prÃªt(e) !", roundTxt: "Tour", winTxt: " a gagnÃ© !", anon: "Anonyme", myMark: "Mon choix", realMark: "Centre rÃ©el :"
            },
            de: {
                title: "Gemeinsam auf die Karte tippen!", author: "Ersteller: Huh Byung doo",
                playerCount: "Spieler", recordScore: "Punktzahl speichern", namePlaceholder: "Name (oder Anonym)", roundCount: "Runden",
                diffSelect: "Schwierigkeit", diffBeginner: "AnfÃ¤nger", diffIntermediate: "Mittel", diffAdvanced: "Fortgeschritten", diffExpert: "Experte", diffCommunity: "ğŸŒ Community-Kurse",
                diffDescBeginner: "GroÃŸzÃ¼gige Fehlertoleranz. Klicken Sie in die NÃ¤he des Landes/der Region.", diffDescInter: "Moderate Fehlertoleranz. Zielen Sie auf die spezifische Stadt.", diffDescAdv: "Geringe Fehlertoleranz. Finden Sie das spezifische Wahrzeichen.", diffDescExpert: "Sehr streng. Bestimmen Sie die genauen Koordinaten.", diffDescComm: "Entdecken Sie Orte, die von Spielern weltweit geteilt wurden!",
                btnStart: "Starten", leaderboardTitle: "ğŸ† Top 3 von heute", leaderboardLoading: "Wird geladen...",
                targetIntro: "Finden Sie diesen Ort auf der Karte!", scoreBoard: "Punkte", resultTitle: "Ergebnis", resultDist: "Verfehlte Distanz", resultScore: "Erreichte Punkte", btnNext: "NÃ¤chste Runde",
                gameEnd: "Beendet!", btnRestart: "ZurÃ¼ck zum MenÃ¼", turnSubtitle: "Bereit fÃ¼r den nÃ¤chsten Ort?", btnReady: "Bereit (Karte ansehen)",
                msgPerfect: "Perfekt! Sie haben genau in den Bereich geklickt!", msgExcellent: "Ausgezeichnet! Unglaublich nah dran.", msgGood: "GroÃŸartig! Sie haben einen guten Orientierungssinn.", msgOkay: "Nah dran, die allgemeine Richtung stimmt.", msgBad: "Ziemlich weit weg. Seien Sie vorsichtiger!", msgFail: "VÃ¶llig daneben. Versuchen Sie es weiter!",
                distHit: "Bereich getroffen! (Vom Zentrum:", playerTurn: " ist dran", playerReady: " ist bereit!", roundTxt: "Runde", winTxt: " gewinnt!", anon: "Anonym", myMark: "Meine Wahl", realMark: "TatsÃ¤chliches Zentrum:"
            },
            pt: {
                title: "Toquem Juntos no Mapa!", author: "Criador: Huh Byung doo",
                playerCount: "Jogadores", recordScore: "Salvar PontuaÃ§Ã£o", namePlaceholder: "Nome (ou AnÃ´nimo)", roundCount: "Rodadas",
                diffSelect: "Dificuldade", diffBeginner: "Iniciante", diffIntermediate: "IntermediÃ¡rio", diffAdvanced: "AvanÃ§ado", diffExpert: "Especialista", diffCommunity: "ğŸŒ Cursos ComunitÃ¡rios",
                diffDescBeginner: "Margem de erro generosa. Clique perto do paÃ­s.", diffDescInter: "Margem moderada. Mire na cidade especÃ­fica.", diffDescAdv: "Margem estreita. Encontre o ponto de referÃªncia especÃ­fico.", diffDescExpert: "Muito rigoroso. Identifique as coordenadas exatas.", diffDescComm: "Explore locais compartilhados por jogadores!",
                btnStart: "ComeÃ§ar", leaderboardTitle: "ğŸ† Top 3 de Hoje", leaderboardLoading: "Carregando...",
                targetIntro: "Encontre este local no mapa!", scoreBoard: "Placar", resultTitle: "Resultado", resultDist: "DistÃ¢ncia percorrida", resultScore: "Pontos", btnNext: "PrÃ³xima Rodada",
                gameEnd: "Terminado!", btnRestart: "Voltar ao Menu", turnSubtitle: "Pronto para o prÃ³ximo local?", btnReady: "Pronto (Ver Mapa)",
                msgPerfect: "Perfeito! VocÃª clicou exatamente na Ã¡rea!", msgExcellent: "Excelente! Incrivelmente perto.", msgGood: "Ã“timo! VocÃª tem um bom senso de direÃ§Ã£o.", msgOkay: "Perto, a direÃ§Ã£o geral estÃ¡ certa.", msgBad: "Bastante longe. Tenha mais cuidado!", msgFail: "Totalmente fora. Continue tentando!",
                distHit: "Ãrea Atingida! (Do centro:", playerTurn: " (Vez)", playerReady: " estÃ¡ pronto!", roundTxt: "Rodada", winTxt: " venceu!", anon: "AnÃ´nimo", myMark: "Minha Escolha", realMark: "Centro Real:"
            },
            it: {
                title: "Tocca Insieme sulla Mappa!", author: "Creatore: Huh Byung doo",
                playerCount: "Giocatori", recordScore: "Salva Punteggio", namePlaceholder: "Nome (o Anonimo)", roundCount: "Turni",
                diffSelect: "DifficoltÃ ", diffBeginner: "Principiante", diffIntermediate: "Intermedio", diffAdvanced: "Avanzato", diffExpert: "Esperto", diffCommunity: "ğŸŒ Corsi Comunitari",
                diffDescBeginner: "Margine di errore ampio. Clicca vicino al paese.", diffDescInter: "Margine moderato. Mira alla cittÃ  specifica.", diffDescAdv: "Margine ristretto. Trova il punto di riferimento.", diffDescExpert: "Molto severo. Individua le coordinate esatte.", diffDescComm: "Esplora i luoghi condivisi dai giocatori!",
                btnStart: "Inizia", leaderboardTitle: "ğŸ† Top 3 di Oggi", leaderboardLoading: "Caricamento...",
                targetIntro: "Trova questo luogo sulla mappa!", scoreBoard: "Punteggi", resultTitle: "Risultato", resultDist: "Distanza mancata", resultScore: "Punti ottenuti", btnNext: "Prossimo Turno",
                gameEnd: "Finito!", btnRestart: "Torna al Menu", turnSubtitle: "Pronto per il prossimo luogo?", btnReady: "Pronto (Vedi Mappa)",
                msgPerfect: "Perfetto! Hai cliccato esattamente nell'area!", msgExcellent: "Eccellente! Incredibilmente vicino.", msgGood: "Ottimo! Hai un buon senso dell'orientamento.", msgOkay: "Vicino, la direzione generale Ã¨ giusta.", msgBad: "Abbastanza lontano. Fai piÃ¹ attenzione!", msgFail: "Completamente fuori strada. Riprova!",
                distHit: "Area Colpita! (Dal centro:", playerTurn: " (Turno)", playerReady: " Ã¨ pronto!", roundTxt: "Turno", winTxt: " vince!", anon: "Anonimo", myMark: "La mia scelta", realMark: "Centro reale:"
            },
            ru: {
                title: "Ğ¢Ğ°Ğ¿Ğ½ĞµĞ¼ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ğ¿Ğ¾ ĞºĞ°Ñ€Ñ‚Ğµ!", author: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ĞµĞ»ÑŒ: Huh Byung doo",
                playerCount: "Ğ˜Ğ³Ñ€Ğ¾ĞºĞ¸", recordScore: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞºĞ¾Ñ€Ğ´", namePlaceholder: "Ğ˜Ğ¼Ñ (Ğ¸Ğ»Ğ¸ ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼)", roundCount: "Ğ Ğ°ÑƒĞ½Ğ´Ñ‹",
                diffSelect: "Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ", diffBeginner: "ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº", diffIntermediate: "Ğ›ÑĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ", diffAdvanced: "ĞŸÑ€Ğ¾Ñ„Ğ¸", diffExpert: "Ğ­ĞºÑĞ¿ĞµÑ€Ñ‚", diffCommunity: "ğŸŒ ĞšĞ°Ñ€Ñ‚Ñ‹ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµÑÑ‚Ğ²Ğ°",
                diffDescBeginner: "Ğ‘Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ. ĞšĞ»Ğ¸ĞºĞ°Ğ¹Ñ‚Ğµ Ñ€ÑĞ´Ğ¾Ğ¼ ÑĞ¾ ÑÑ‚Ñ€Ğ°Ğ½Ğ¾Ğ¹.", diffDescInter: "Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ. Ğ¦ĞµĞ»ÑŒÑ‚ĞµÑÑŒ Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´.", diffDescAdv: "ĞœĞ°Ğ»Ğ°Ñ Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ñ‚Ğ¾Ñ‡Ğ½ÑƒÑ Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ.", diffDescExpert: "ĞÑ‡ĞµĞ½ÑŒ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾. Ğ£ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹.", diffDescComm: "Ğ˜ÑÑĞ»ĞµĞ´ÑƒĞ¹Ñ‚Ğµ Ğ¼ĞµÑÑ‚Ğ° Ğ¾Ñ‚ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ¾Ğ² ÑĞ¾ Ğ²ÑĞµĞ³Ğ¾ Ğ¼Ğ¸Ñ€Ğ°!",
                btnStart: "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ", leaderboardTitle: "ğŸ† Ğ¢Ğ¾Ğ¿-3 Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ", leaderboardLoading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...",
                targetIntro: "ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¾ Ğ¼ĞµÑÑ‚Ğ¾ Ğ½Ğ° ĞºĞ°Ñ€Ñ‚Ğµ!", scoreBoard: "Ğ¡Ñ‡ĞµÑ‚", resultTitle: "Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚", resultDist: "ĞŸÑ€Ğ¾Ğ¼Ğ°Ñ… (Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ñ)", resultScore: "ĞÑ‡ĞºĞ¸", btnNext: "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ…Ğ¾Ğ´",
                gameEnd: "Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾!", btnRestart: "Ğ’ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", turnSubtitle: "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ¸ÑĞºĞ°Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞµ Ğ¼ĞµÑÑ‚Ğ¾?", btnReady: "Ğ“Ğ¾Ñ‚Ğ¾Ğ² (ĞšĞ°Ñ€Ñ‚Ğ°)",
                msgPerfect: "Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾! Ğ¢Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ·Ğ¾Ğ½Ñƒ!", msgExcellent: "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ĞĞµĞ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾.", msgGood: "Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾! Ğ£ Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾ ĞºĞ°Ñ€Ñ‚Ñ‹.", msgOkay: "Ğ‘Ğ»Ğ¸Ğ·ĞºĞ¾, Ğ²ĞµÑ€Ğ½Ğ¾Ğµ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ.", msgBad: "Ğ”Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ°Ğ»ĞµĞºĞ¾. Ğ‘ÑƒĞ´ÑŒÑ‚Ğµ Ñ‚Ğ¾Ñ‡Ğ½ĞµĞµ!", msgFail: "ĞœĞ¸Ğ¼Ğ¾. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ğµ!",
                distHit: "ĞŸĞ¾Ğ¿Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ·Ğ¾Ğ½Ñƒ! (ĞÑ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°:", playerTurn: " (Ğ¥Ğ¾Ğ´)", playerReady: " Ğ³Ğ¾Ñ‚Ğ¾Ğ²!", roundTxt: "Ğ Ğ°ÑƒĞ½Ğ´", winTxt: " Ğ¿Ğ¾Ğ±ĞµĞ¶Ğ´Ğ°ĞµÑ‚!", anon: "ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼", myMark: "ĞœĞ¾Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€", realMark: "Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ†ĞµĞ½Ñ‚Ñ€:"
            },
            hi: {
                title: "à¤¨à¤•à¥à¤¶à¥‡ à¤ªà¤° à¤à¤• à¤¸à¤¾à¤¥ à¤Ÿà¥ˆà¤ª à¤•à¤°à¥‡à¤‚!", author: "à¤¨à¤¿à¤°à¥à¤®à¤¾à¤¤à¤¾: Huh Byung doo",
                playerCount: "à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¥€", recordScore: "à¤¸à¥à¤•à¥‹à¤° à¤¸à¤¹à¥‡à¤œà¥‡à¤‚", namePlaceholder: "à¤¨à¤¾à¤® (à¤¯à¤¾ à¤…à¤¨à¤¾à¤®)", roundCount: "à¤°à¤¾à¤‰à¤‚à¤¡",
                diffSelect: "à¤•à¤ à¤¿à¤¨à¤¾à¤ˆ", diffBeginner: "à¤¶à¥à¤°à¥à¤†à¤¤à¥€", diffIntermediate: "à¤®à¤§à¥à¤¯à¤®", diffAdvanced: "à¤‰à¤¨à¥à¤¨à¤¤", diffExpert: "à¤µà¤¿à¤¶à¥‡à¤·à¤œà¥à¤", diffCommunity: "ğŸŒ à¤¸à¤®à¥à¤¦à¤¾à¤¯ à¤®à¤¾à¤¨à¤šà¤¿à¤¤à¥à¤°",
                diffDescBeginner: "à¤¬à¤¡à¤¼à¥€ à¤›à¥‚à¤Ÿà¥¤ à¤¦à¥‡à¤¶ à¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¥à¤²à¤¿à¤• à¤•à¤°à¥‡à¤‚à¥¤", diffDescInter: "à¤®à¤§à¥à¤¯à¤® à¤›à¥‚à¤Ÿà¥¤ à¤¶à¤¹à¤° à¤ªà¤° à¤¨à¤¿à¤¶à¤¾à¤¨à¤¾ à¤²à¤—à¤¾à¤à¤à¥¤", diffDescAdv: "à¤•à¤® à¤›à¥‚à¤Ÿà¥¤ à¤µà¤¿à¤¶à¤¿à¤·à¥à¤Ÿ à¤¸à¥à¤¥à¤¾à¤¨ à¤–à¥‹à¤œà¥‡à¤‚à¥¤", diffDescExpert: "à¤¬à¤¹à¥à¤¤ à¤¸à¤–à¥à¤¤à¥¤ à¤¸à¤Ÿà¥€à¤• à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶à¤¾à¤‚à¤• à¤–à¥‹à¤œà¥‡à¤‚à¥¤", diffDescComm: "à¤¦à¥à¤¨à¤¿à¤¯à¤¾ à¤­à¤° à¤•à¥‡ à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¤¿à¤¯à¥‹à¤‚ à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤¸à¤¾à¤à¤¾ à¤•à¤¿à¤ à¤—à¤ à¤¸à¥à¤¥à¤¾à¤¨ à¤–à¥‹à¤œà¥‡à¤‚!",
                btnStart: "à¤¶à¥à¤°à¥‚ à¤•à¤°à¥‡à¤‚", leaderboardTitle: "ğŸ† à¤†à¤œ à¤•à¥‡ à¤Ÿà¥‰à¤ª 3", leaderboardLoading: "à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...",
                targetIntro: "à¤¨à¤•à¥à¤¶à¥‡ à¤ªà¤° à¤¯à¤¹ à¤¸à¥à¤¥à¤¾à¤¨ à¤–à¥‹à¤œà¥‡à¤‚!", scoreBoard: "à¤¸à¥à¤•à¥‹à¤°", resultTitle: "à¤ªà¤°à¤¿à¤£à¤¾à¤®", resultDist: "à¤¦à¥‚à¤°à¥€ à¤šà¥‚à¤• à¤—à¤", resultScore: "à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤¸à¥à¤•à¥‹à¤°", btnNext: "à¤…à¤—à¤²à¥€ à¤¬à¤¾à¤°à¥€",
                gameEnd: "à¤¸à¤®à¤¾à¤ªà¥à¤¤!", btnRestart: "à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚", turnSubtitle: "à¤…à¤—à¤²à¤¾ à¤¸à¥à¤¥à¤¾à¤¨ à¤–à¥‹à¤œà¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤¤à¥ˆà¤¯à¤¾à¤° à¤¹à¥ˆà¤‚?", btnReady: "à¤¤à¥ˆà¤¯à¤¾à¤° (à¤¨à¤•à¥à¤¶à¤¾ à¤¦à¥‡à¤–à¥‡à¤‚)",
                msgPerfect: "à¤¬à¤¿à¤²à¥à¤•à¥à¤² à¤¸à¤¹à¥€! à¤†à¤ªà¤¨à¥‡ à¤¸à¤Ÿà¥€à¤• à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤ªà¤° à¤•à¥à¤²à¤¿à¤• à¤•à¤¿à¤¯à¤¾!", msgExcellent: "à¤‰à¤¤à¥à¤•à¥ƒà¤·à¥à¤Ÿ! à¤¬à¤¹à¥à¤¤ à¤•à¤°à¥€à¤¬à¥¤", msgGood: "à¤¬à¤¢à¤¼à¤¿à¤¯à¤¾! à¤†à¤ªà¤•à¥‹ à¤¸à¥à¤¥à¤¾à¤¨ à¤•à¥€ à¤…à¤šà¥à¤›à¥€ à¤¸à¤®à¤ à¤¹à¥ˆà¥¤", msgOkay: "à¤•à¤°à¥€à¤¬, à¤¦à¤¿à¤¶à¤¾ à¤¸à¤¹à¥€ à¤¹à¥ˆà¥¤", msgBad: "à¤•à¤¾à¤«à¥€ à¤¦à¥‚à¤°à¥¤ à¤¸à¤¾à¤µà¤§à¤¾à¤¨ à¤°à¤¹à¥‡à¤‚!", msgFail: "à¤¬à¤¿à¤²à¥à¤•à¥à¤² à¤—à¤²à¤¤à¥¤ à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¤¤à¥‡ à¤°à¤¹à¥‡à¤‚!",
                distHit: "à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤ªà¤° à¤¨à¤¿à¤¶à¤¾à¤¨à¤¾! (à¤•à¥‡à¤‚à¤¦à¥à¤° à¤¸à¥‡:", playerTurn: " à¤•à¥€ à¤¬à¤¾à¤°à¥€", playerReady: " à¤¤à¥ˆà¤¯à¤¾à¤° à¤¹à¥ˆ!", roundTxt: "à¤°à¤¾à¤‰à¤‚à¤¡", winTxt: " à¤•à¥€ à¤œà¥€à¤¤!", anon: "à¤…à¤¨à¤¾à¤®", myMark: "à¤®à¥‡à¤°à¤¾ à¤…à¤¨à¥à¤®à¤¾à¤¨", realMark: "à¤µà¤¾à¤¸à¥à¤¤à¤µà¤¿à¤• à¤•à¥‡à¤‚à¤¦à¥à¤°:"
            }
        };

        // ë¸Œë¼ìš°ì € ì–¸ì–´ ìë™ ê°ì§€ ë° ì„¤ì •
        let currentLang = 'ko';
        const userLang = navigator.language || navigator.userLanguage;
        if (userLang.startsWith('en')) currentLang = 'en';
        else if (userLang.startsWith('ja')) currentLang = 'ja';
        else if (userLang.startsWith('zh')) currentLang = 'zh';
        else if (userLang.startsWith('es')) currentLang = 'es';
        else if (userLang.startsWith('fr')) currentLang = 'fr';
        else if (userLang.startsWith('de')) currentLang = 'de';
        else if (userLang.startsWith('pt')) currentLang = 'pt';
        else if (userLang.startsWith('it')) currentLang = 'it';
        else if (userLang.startsWith('ru')) currentLang = 'ru';
        else if (userLang.startsWith('hi')) currentLang = 'hi';
        else if (!userLang.startsWith('ko')) currentLang = 'en'; // ê·¸ ì™¸ì˜ ì–¸ì–´ëŠ” ì˜ì–´ë¡œ í´ë°±

        function updateTexts() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[currentLang][key]) {
                    if(el.tagName === 'INPUT' && el.type === 'text') el.placeholder = i18n[currentLang][key];
                    else el.innerHTML = i18n[currentLang][key];
                }
            });
            for (let i = 1; i <= gameState.numPlayers; i++) {
                const input = document.getElementById(`player-name-${i}`);
                if(input) input.placeholder = `${i}P ${i18n[currentLang].namePlaceholder}`;
            }
            updateDiffDesc(gameState.difficulty);
        }

        document.getElementById('lang-selector').addEventListener('change', (e) => {
            currentLang = e.target.value;
            updateTexts();
            if (!document.getElementById('hud-top').classList.contains('hidden') && gameState.currentTarget) {
                const placeName = getPlaceName(gameState.currentTarget);
                document.getElementById('hud-target').textContent = placeName;
                document.getElementById('turn-target-text').textContent = placeName;
            }
        });


        // --- Firebase ì„¤ì • ---
        let db, auth, user;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-geo-game';
        let isFirebaseReady = false;

        try {
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
            if (firebaseConfig) {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) await signInWithCustomToken(auth, __initial_auth_token);
                    else await signInAnonymously(auth);
                };

                initAuth().then(() => {
                    onAuthStateChanged(auth, (u) => {
                        if (u) {
                            user = u;
                            isFirebaseReady = true;
                            loadLeaderboard();
                            loadCommunityLocations();
                        }
                    });
                });
            } else {
                document.getElementById('leaderboard-list').innerHTML = `<li class="text-gray-400 text-center py-1">${currentLang === 'ko' ? 'í´ë¼ìš°ë“œê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.' : 'Cloud disconnected.'}</li>`;
            }
        } catch (e) {
            console.warn("Firebase Init Failed.", e);
        }

        // --- ë‹¤êµ­ì–´ ì§€ì› ì¥ì†Œ ëª©ë¡ (11ê°œ êµ­ì–´ ì§€ì›) ---
        // ì–¸ì–´ë³„ ì´ë¦„ì´ ì—†ìœ¼ë©´ ì˜ì–´(en) ë˜ëŠ” í•œêµ­ì–´(ko)ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
        const locationDB = {
            beginner: [
                { name: { ko: "ëŒ€í•œë¯¼êµ­", en: "South Korea", ja: "éŸ“å›½", zh: "éŸ©å›½", es: "Corea del Sur", fr: "CorÃ©e du Sud", de: "SÃ¼dkorea", pt: "Coreia do Sul", it: "Corea del Sud", ru: "Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ", hi: "à¤¦à¤•à¥à¤·à¤¿à¤£ à¤•à¥‹à¤°à¤¿à¤¯à¤¾" }, lat: 36.5, lng: 127.5, radius: 150 },
                { name: { ko: "í”„ë‘ìŠ¤", en: "France", ja: "ãƒ•ãƒ©ãƒ³ã‚¹", zh: "æ³•å›½", es: "Francia", fr: "France", de: "Frankreich", pt: "FranÃ§a", it: "Francia", ru: "Ğ¤Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ", hi: "à¤«à¥à¤°à¤¾à¤‚à¤¸" }, lat: 46.2276, lng: 2.2137, radius: 400 },
                { name: { ko: "í˜¸ì£¼", en: "Australia", ja: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢", zh: "æ¾³å¤§åˆ©äºš", es: "Australia", fr: "Australie", de: "Australien", pt: "AustrÃ¡lia", it: "Australia", ru: "ĞĞ²ÑÑ‚Ñ€Ğ°Ğ»Ğ¸Ñ", hi: "à¤‘à¤¸à¥à¤Ÿà¥à¤°à¥‡à¤²à¤¿à¤¯à¤¾" }, lat: -25.2743, lng: 133.7751, radius: 2000 },
                { name: { ko: "ì´ì§‘íŠ¸", en: "Egypt", ja: "ã‚¨ã‚¸ãƒ—ãƒˆ", zh: "åŸƒåŠ", es: "Egipto", fr: "Ã‰gypte", de: "Ã„gypten", pt: "Egito", it: "Egitto", ru: "Ğ•Ğ³Ğ¸Ğ¿ĞµÑ‚", hi: "à¤®à¤¿à¤¸à¥à¤°" }, lat: 26.8205, lng: 30.8024, radius: 500 },
                { name: { ko: "ë¸Œë¼ì§ˆ", en: "Brazil", ja: "ãƒ–ãƒ©ã‚¸ãƒ«", zh: "å·´è¥¿", es: "Brasil", fr: "BrÃ©sil", de: "Brasilien", pt: "Brasil", it: "Brasile", ru: "Ğ‘Ñ€Ğ°Ğ·Ğ¸Ğ»Ğ¸Ñ", hi: "à¤¬à¥à¤°à¤¾à¤œà¤¼à¤¿à¤²" }, lat: -14.2350, lng: -51.9252, radius: 1500 },
                { name: { ko: "ë¯¸êµ­", en: "United States", ja: "ã‚¢ãƒ¡ãƒªã‚«", zh: "ç¾å›½", es: "Estados Unidos", fr: "Ã‰tats-Unis", de: "USA", pt: "Estados Unidos", it: "Stati Uniti", ru: "Ğ¡Ğ¨Ğ", hi: "à¤¸à¤‚à¤¯à¥à¤•à¥à¤¤ à¤°à¤¾à¤œà¥à¤¯ à¤…à¤®à¥‡à¤°à¤¿à¤•à¤¾" }, lat: 37.0902, lng: -95.7129, radius: 2000 }
            ],
            intermediate: [
                { name: { ko: "ì„œìš¸íŠ¹ë³„ì‹œ", en: "Seoul", ja: "ã‚½ã‚¦ãƒ«", zh: "é¦–å°”", es: "SeÃºl", fr: "SÃ©oul", de: "Seoul", pt: "Seul", it: "Seul", ru: "Ğ¡ĞµÑƒĞ»", hi: "à¤¸à¤¿à¤¯à¥‹à¤²" }, lat: 37.5665, lng: 126.9780, radius: 15 },
                { name: { ko: "ë‰´ìš• (ë¯¸êµ­)", en: "New York", ja: "ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯", zh: "çº½çº¦", es: "Nueva York", fr: "New York", de: "New York", pt: "Nova Iorque", it: "New York", ru: "ĞÑŒÑ-Ğ™Ğ¾Ñ€Ğº", hi: "à¤¨à¥à¤¯à¥‚à¤¯à¥‰à¤°à¥à¤•" }, lat: 40.7127, lng: -74.0059, radius: 20 },
                { name: { ko: "ëŸ°ë˜ (ì˜êµ­)", en: "London", ja: "ãƒ­ãƒ³ãƒ‰ãƒ³", zh: "ä¼¦æ•¦", es: "Londres", fr: "Londres", de: "London", pt: "Londres", it: "Londra", ru: "Ğ›Ğ¾Ğ½Ğ´Ğ¾Ğ½", hi: "à¤²à¤‚à¤¦à¤¨" }, lat: 51.5073, lng: -0.1276, radius: 25 },
                { name: { ko: "ë„ì¿„ (ì¼ë³¸)", en: "Tokyo", ja: "æ±äº¬", zh: "ä¸œäº¬", es: "Tokio", fr: "Tokyo", de: "Tokio", pt: "TÃ³quio", it: "Tokyo", ru: "Ğ¢Ğ¾ĞºĞ¸Ğ¾", hi: "à¤Ÿà¥‹à¤•à¥à¤¯à¥‹" }, lat: 35.6761, lng: 139.6503, radius: 30 },
                { name: { ko: "íŒŒë¦¬ (í”„ë‘ìŠ¤)", en: "Paris", ja: "ãƒ‘ãƒª", zh: "å·´é»", es: "ParÃ­s", fr: "Paris", de: "Paris", pt: "Paris", it: "Parigi", ru: "ĞŸĞ°Ñ€Ğ¸Ğ¶", hi: "à¤ªà¥‡à¤°à¤¿à¤¸" }, lat: 48.8566, lng: 2.3522, radius: 15 }
            ],
            advanced: [
                { name: { ko: "ì—í íƒ‘", en: "Eiffel Tower", ja: "ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”", zh: "åŸƒè²å°”é“å¡”", es: "Torre Eiffel", fr: "Tour Eiffel", de: "Eiffelturm", pt: "Torre Eiffel", it: "Torre Eiffel", ru: "Ğ­Ğ¹Ñ„ĞµĞ»ĞµĞ²Ğ° Ğ±Ğ°ÑˆĞ½Ñ", hi: "à¤à¤«à¤¿à¤² à¤Ÿà¤¾à¤µà¤°" }, lat: 48.8583, lng: 2.2944, radius: 2 },
                { name: { ko: "ììœ ì˜ ì—¬ì‹ ìƒ", en: "Statue of Liberty", ja: "è‡ªç”±ã®å¥³ç¥", zh: "è‡ªç”±å¥³ç¥åƒ", es: "Estatua de la Libertad", fr: "Statue de la LibertÃ©", de: "Freiheitsstatue", pt: "EstÃ¡tua da Liberdade", it: "Statua della LibertÃ ", ru: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ñ‹", hi: "à¤¸à¥à¤Ÿà¥ˆà¤šà¥à¤¯à¥‚ à¤‘à¤« à¤²à¤¿à¤¬à¤°à¥à¤Ÿà¥€" }, lat: 40.6892, lng: -74.0445, radius: 2 },
                { name: { ko: "ì½œë¡œì„¸ì›€", en: "Colosseum", ja: "ã‚³ãƒ­ãƒƒã‚»ã‚ª", zh: "ç½—é©¬æ–—å…½åœº", es: "Coliseo", fr: "ColisÃ©e", de: "Kolosseum", pt: "Coliseu", it: "Colosseo", ru: "ĞšĞ¾Ğ»Ğ¸Ğ·ĞµĞ¹", hi: "à¤•à¥‹à¤²à¤¿à¤œà¤¼à¥€à¤¯à¤®" }, lat: 41.8902, lng: 12.4922, radius: 2 },
                { name: { ko: "ë§Œë¦¬ì¥ì„±", en: "Great Wall of China", ja: "ä¸‡é‡Œã®é•·åŸ", zh: "ä¸‡é‡Œé•¿åŸ", es: "Gran Muralla China", fr: "Grande Muraille", de: "Chinesische Mauer", pt: "Grande Muralha", it: "Grande Muraglia", ru: "Ğ’ĞµĞ»Ğ¸ĞºĞ°Ñ ĞšĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ°Ñ ÑÑ‚ĞµĞ½Ğ°", hi: "à¤šà¥€à¤¨ à¤•à¥€ à¤®à¤¹à¤¾à¤¨ à¤¦à¥€à¤µà¤¾à¤°" }, lat: 40.4319, lng: 116.5703, radius: 10 },
                { name: { ko: "íƒ€ì§€ë§ˆí• ", en: "Taj Mahal", ja: "ã‚¿ãƒ¼ã‚¸ãƒãƒãƒ«", zh: "æ³°å§¬é™µ", es: "Taj Mahal", fr: "Taj Mahal", de: "Taj Mahal", pt: "Taj Mahal", it: "Taj Mahal", ru: "Ğ¢Ğ°Ğ´Ğ¶-ĞœĞ°Ñ…Ğ°Ğ»", hi: "à¤¤à¤¾à¤œ à¤®à¤¹à¤²" }, lat: 27.1751, lng: 78.0421, radius: 2 }
            ],
            expert: [
                { name: { ko: "ìš°ê¸ˆì¹˜", en: "Ugeumchi", ja: "ç‰›ç¦é›‰", zh: "ç‰›ç¦é›‰", es: "Ugeumchi", fr: "Ugeumchi", de: "Ugeumchi", pt: "Ugeumchi", it: "Ugeumchi", ru: "Ğ£Ğ³Ñ‹Ğ¼Ñ‡Ñ…Ğ¸", hi: "à¤‰à¤—à¥à¤¯à¥‚à¤®à¤šà¥€" }, lat: 36.4353, lng: 127.1190, radius: 2 },
                { name: { ko: "ì•„ë¹„ë‡½", en: "Avignon", ja: "ã‚¢ãƒ´ã‚£ãƒ‹ãƒ§ãƒ³", zh: "é˜¿ç»´å°¼ç¿", es: "AviÃ±Ã³n", fr: "Avignon", de: "Avignon", pt: "Avignon", it: "Avignone", ru: "ĞĞ²Ğ¸Ğ½ÑŒĞ¾Ğ½", hi: "à¤à¤µà¤¿à¤—à¥à¤¨à¤¨" }, lat: 43.9493, lng: 4.8055, radius: 5 },
                { name: { ko: "ì›Œí„¸ë£¨", en: "Waterloo", ja: "ãƒ¯ãƒ¼ãƒ†ãƒ«ãƒ­ãƒ¼", zh: "æ»‘é“å¢", es: "Waterloo", fr: "Waterloo", de: "Waterloo", pt: "Waterloo", it: "Waterloo", ru: "Ğ’Ğ°Ñ‚ĞµÑ€Ğ»Ğ¾Ğ¾", hi: "à¤µà¤¾à¤Ÿà¤°à¤²à¥‚" }, lat: 50.7135, lng: 4.3965, radius: 5 },
                { name: { ko: "ì˜¤ë§ˆí•˜ í•´ë³€", en: "Omaha Beach", ja: "ã‚ªãƒãƒãƒ»ãƒ“ãƒ¼ãƒ", zh: "å¥¥é©¬å“ˆæµ·æ»©", es: "Playa de Omaha", fr: "Omaha Beach", de: "Omaha Beach", pt: "Praia de Omaha", it: "Omaha Beach", ru: "ĞŸĞ»ÑĞ¶ ĞĞ¼Ğ°Ñ…Ğ°", hi: "à¤“à¤®à¤¾à¤¹à¤¾ à¤¬à¥€à¤š" }, lat: 49.3700, lng: -0.8800, radius: 5 },
                { name: { ko: "ì²´ë¥´ë…¸ë¹Œ", en: "Chernobyl", ja: "ãƒã‚§ãƒ«ãƒãƒ–ã‚¤ãƒª", zh: "åˆ‡å°”è¯ºè´åˆ©", es: "ChernÃ³bil", fr: "Tchernobyl", de: "Tschernobyl", pt: "Chernobyl", it: "ÄŒernobyl'", ru: "Ğ§ĞµÑ€Ğ½Ğ¾Ğ±Ñ‹Ğ»ÑŒ", hi: "à¤šà¥‡à¤°à¤¨à¥‹à¤¬à¤¿à¤²" }, lat: 51.3891, lng: 30.0994, radius: 3 }
            ],
            community: []
        };

        const difficultyScale = { beginner: 1500, intermediate: 400, advanced: 50, expert: 10, community: 150 };

        let map, baseLayer, labelLayer;
        let mapMarkers = [];
        let mapPolyline = null;

        const gameState = {
            numPlayers: 1, difficulty: 'beginner', currentRound: 1, maxRounds: 3,
            currentPlayer: 1, scores: [], playerNames: [],
            currentTarget: null, roundLocations: [], isGuessing: false, recordScore: false
        };

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            setupEventListeners();
            generateNameInputs();
            document.getElementById('lang-selector').value = currentLang;
            updateTexts();
        });

        function initMap() {
            map = L.map('map', { center: [30, 120], zoom: 3, zoomControl: false });
            L.control.zoom({ position: 'bottomright' }).addTo(map);
            baseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', { noWrap: true }).addTo(map);
            labelLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', { noWrap: true });
            map.on('click', handleMapClick);
        }

        function generateNameInputs() {
            const container = document.getElementById('name-inputs-container');
            container.innerHTML = '';
            for (let i = 1; i <= gameState.numPlayers; i++) {
                container.innerHTML += `<input type="text" id="player-name-${i}" class="w-full p-2 border border-gray-300 rounded text-xs sm:text-sm focus:outline-none focus:border-green-500">`;
            }
            updateTexts();
        }

        function updateDiffDesc(diff) {
            const descEl = document.getElementById('diff-desc');
            if(diff === 'beginner') descEl.textContent = i18n[currentLang].diffDescBeginner;
            if(diff === 'intermediate') descEl.textContent = i18n[currentLang].diffDescInter;
            if(diff === 'advanced') descEl.textContent = i18n[currentLang].diffDescAdv;
            if(diff === 'expert') descEl.textContent = i18n[currentLang].diffDescExpert;
            if(diff === 'community') descEl.textContent = i18n[currentLang].diffDescComm;
        }

        function setupEventListeners() {
            document.querySelectorAll('.player-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.player-btn').forEach(b => b.classList.replace('bg-green-600', 'bg-white'));
                    document.querySelectorAll('.player-btn').forEach(b => b.classList.replace('text-white', 'text-gray-600'));
                    e.target.classList.replace('bg-white', 'bg-green-600');
                    e.target.classList.replace('text-gray-600', 'text-white');
                    gameState.numPlayers = parseInt(e.target.dataset.players);
                    generateNameInputs();
                });
            });

            document.querySelectorAll('.round-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.round-btn').forEach(b => b.classList.replace('bg-green-600', 'bg-white'));
                    document.querySelectorAll('.round-btn').forEach(b => b.classList.replace('text-white', 'text-gray-600'));
                    e.target.classList.replace('bg-white', 'bg-green-600');
                    e.target.classList.replace('text-gray-600', 'text-white');
                    gameState.maxRounds = parseInt(e.target.dataset.rounds);
                });
            });

            document.querySelectorAll('.diff-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const targetBtn = e.target.closest('.diff-btn');
                    
                    // ê¸°ì¡´ ë²„íŠ¼ë“¤ ì´ˆê¸°í™”
                    document.querySelectorAll('.diff-btn').forEach(b => {
                        if (b.dataset.diff === 'community') {
                            b.classList.remove('bg-indigo-50', 'text-indigo-700', 'border-indigo-400');
                            b.classList.add('bg-white', 'text-gray-600', 'border-gray-300');
                        } else {
                            b.classList.remove('bg-green-500', 'text-white', 'border-green-600', 'shadow-md');
                            b.classList.add('bg-gray-100', 'text-gray-500', 'border-gray-300');
                        }
                    });
                    
                    // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
                    if (targetBtn.dataset.diff === 'community') {
                        targetBtn.classList.remove('bg-white', 'text-gray-600', 'border-gray-300');
                        targetBtn.classList.add('bg-indigo-50', 'text-indigo-700', 'border-indigo-400');
                    } else {
                        targetBtn.classList.remove('bg-gray-100', 'text-gray-500', 'border-gray-300');
                        targetBtn.classList.add('bg-green-500', 'text-white', 'border-green-600', 'shadow-md');
                    }
                    
                    gameState.difficulty = targetBtn.dataset.diff;
                    updateDiffDesc(gameState.difficulty);
                });
            });

            document.getElementById('record-score-toggle').addEventListener('change', (e) => {
                gameState.recordScore = e.target.checked;
                document.getElementById('name-inputs-container').classList.toggle('hidden', !gameState.recordScore);
            });

            document.getElementById('btn-start-game').addEventListener('click', startGame);

            document.getElementById('btn-ready').addEventListener('click', () => {
                hideModal('modal-turn');
                gameState.isGuessing = true;
                document.getElementById('map').classList.add('guessing-cursor');
            });

            document.getElementById('btn-next-turn').addEventListener('click', () => {
                hideModal('modal-result');
                clearMapMarkers();
                nextTurn();
            });

            document.getElementById('btn-restart').addEventListener('click', () => {
                hideModal('modal-final');
                showModal('modal-start');
            });
        }

        function loadCommunityLocations() {
            if (!user || !db) return;
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'geo_custom_locations'), (snapshot) => {
                const loaded = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    loaded.push({ name: { ko: data.name, en: data.name }, lat: data.lat, lng: data.lng, radius: data.radius });
                });
                locationDB.community = loaded;
                document.getElementById('btn-community-diff').innerHTML = `${i18n[currentLang].diffCommunity} (${loaded.length})`;
            });
        }

        function loadLeaderboard() {
            if (!user || !db) return;
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'geo_scores_daily'), (snapshot) => {
                const today = new Date().toLocaleDateString();
                let allScores = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.date === today) allScores.push(data);
                });
                allScores.sort((a, b) => b.score - a.score);
                const top3 = allScores.slice(0, 3);
                
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = '';
                if (top3.length === 0) {
                    list.innerHTML = `<li class="text-gray-400 text-center py-1 text-xs">${currentLang === 'ko' ? 'ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.' : 'No records yet.'}</li>`;
                    return;
                }
                const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
                top3.forEach((rec, idx) => {
                    list.innerHTML += `<li class="flex justify-between items-center bg-white px-2 py-1 border rounded"><div class="font-bold">${medals[idx]} ${rec.name}</div><div class="text-right text-green-600 font-black">${rec.score.toLocaleString()}</div></li>`;
                });
            });
        }

        async function saveScoreToFirebase(playerName, score) {
            if (!user || !db || !gameState.recordScore) return;
            const finalName = playerName.trim() === '' ? i18n[currentLang].anon : playerName;
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'geo_scores_daily'), {
                    name: finalName, score: score, date: new Date().toLocaleDateString(), timestamp: Date.now()
                });
            } catch (e) { console.error(e); }
        }

        function startGame() {
            gameState.currentRound = 1;
            gameState.currentPlayer = 1;
            gameState.scores = Array(gameState.numPlayers).fill(0);
            gameState.playerNames = [];
            for(let i=1; i<=gameState.numPlayers; i++) {
                const input = document.getElementById(`player-name-${i}`);
                gameState.playerNames.push(input ? input.value : '');
            }

            let availableLocations = [...locationDB[gameState.difficulty]];
            if (availableLocations.length === 0) return;
            shuffleArray(availableLocations);
            
            const totalQ = gameState.numPlayers * maxRoundsSafe();
            gameState.roundLocations = [];
            let qIdx = 0;
            while(gameState.roundLocations.length < totalQ) {
                gameState.roundLocations.push(availableLocations[qIdx % availableLocations.length]);
                qIdx++;
            }

            hideModal('modal-start');
            document.getElementById('hud-top').classList.remove('hidden');
            updateHUDScore();
            prepareTurn();
        }
        
        function maxRoundsSafe() { return gameState.maxRounds || 3; }

        function getPlaceName(locObj) {
            return locObj.name[currentLang] || locObj.name['en'] || locObj.name['ko'];
        }

        function prepareTurn() {
            const qIdx = ((gameState.currentRound - 1) * gameState.numPlayers) + (gameState.currentPlayer - 1);
            gameState.currentTarget = gameState.roundLocations[qIdx];

            const pName = gameState.playerNames[gameState.currentPlayer - 1] || `${gameState.currentPlayer}P`;
            const placeName = getPlaceName(gameState.currentTarget);

            document.getElementById('turn-player-text').textContent = currentLang === 'ko' ? `${pName}${i18n[currentLang].playerReady}` : `${pName} ${i18n[currentLang].playerReady}`;
            document.getElementById('turn-target-text').textContent = placeName;
            
            document.getElementById('hud-player').textContent = currentLang === 'ko' || currentLang === 'ja' || currentLang === 'zh' ? `${pName}${i18n[currentLang].playerTurn}` : `${pName}${i18n[currentLang].playerTurn}`;
            document.getElementById('hud-round').textContent = `${i18n[currentLang].roundTxt}: ${gameState.currentRound} / ${gameState.maxRounds}`;
            document.getElementById('hud-target').textContent = placeName;

            map.setView([30, 0], 2, { animate: true, duration: 1 });
            showModal('modal-turn');
        }

        function handleMapClick(e) {
            if (!gameState.isGuessing) return;
            gameState.isGuessing = false;
            document.getElementById('map').classList.remove('guessing-cursor');

            const guessLatLng = e.latlng;
            const actualLatLng = L.latLng(gameState.currentTarget.lat, gameState.currentTarget.lng);
            const distanceKm = map.distance(guessLatLng, actualLatLng) / 1000;
            const targetRadius = gameState.currentTarget.radius || 20;
            const effectiveDist = Math.max(0, distanceKm - targetRadius);

            let score = Math.round(10000 * Math.exp(-effectiveDist / difficultyScale[gameState.difficulty]));
            if (score < 50) score = 0;

            gameState.scores[gameState.currentPlayer - 1] += score;
            updateHUDScore();
            showResult(guessLatLng, actualLatLng, distanceKm, effectiveDist, score);
        }

        function showResult(guess, actual, dist, effDist, score) {
            labelLayer.addTo(map);
            const gMark = L.marker(guess).addTo(map).bindPopup(i18n[currentLang].myMark).openPopup();
            
            const redIcon = new L.Icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
            });
            const tMark = L.marker(actual, {icon: redIcon}).addTo(map).bindPopup(`${i18n[currentLang].realMark} ${getPlaceName(gameState.currentTarget)}`);
            
            mapPolyline = L.polyline([guess, actual], { color: effDist === 0 ? '#3b82f6' : '#22c55e', weight: 3, dashArray: '5, 10' }).addTo(map);
            mapMarkers.push(gMark, tMark);
            map.fitBounds(L.latLngBounds([guess, actual]), { padding: [50, 50], maxZoom: 6 });

            const distEl = document.getElementById('result-distance');
            if (effDist === 0) {
                distEl.textContent = `${i18n[currentLang].distHit} ${dist.toLocaleString(undefined, {maximumFractionDigits: 1})} km)`;
                distEl.className = "text-lg sm:text-2xl font-black text-blue-600 break-keep";
            } else {
                distEl.textContent = `${dist.toLocaleString(undefined, {maximumFractionDigits: 1})} km`;
                distEl.className = "text-lg sm:text-2xl font-black text-red-500 break-keep";
            }
            
            document.getElementById('result-score').textContent = score.toLocaleString();
            
            let msg = "";
            if (effDist === 0) msg = i18n[currentLang].msgPerfect;
            else if (score >= 9000) msg = i18n[currentLang].msgExcellent;
            else if (score >= 7000) msg = i18n[currentLang].msgGood;
            else if (score >= 4000) msg = i18n[currentLang].msgOkay;
            else if (score > 0) msg = i18n[currentLang].msgBad;
            else msg = i18n[currentLang].msgFail;
            
            document.getElementById('result-msg').textContent = msg;
            setTimeout(() => { showModal('modal-result'); }, 1000);
        }

        function nextTurn() {
            gameState.currentPlayer++;
            if (gameState.currentPlayer > gameState.numPlayers) {
                gameState.currentPlayer = 1;
                gameState.currentRound++;
            }
            if (gameState.currentRound > gameState.maxRounds) endGame();
            else prepareTurn();
        }

        function endGame() {
            document.getElementById('hud-top').classList.add('hidden');
            const list = document.getElementById('final-scores-list');
            list.innerHTML = '';
            
            let highScore = -1, winnerIdx = 0;
            gameState.scores.forEach((sc, idx) => {
                if (sc > highScore) { highScore = sc; winnerIdx = idx; }
                const pName = gameState.playerNames[idx] || `${idx + 1}P`;
                list.innerHTML += `<div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-200"><span class="font-bold text-gray-700">${pName}</span><span class="font-black text-green-600">${sc.toLocaleString()}</span></div>`;
                if (gameState.recordScore) saveScoreToFirebase(pName, sc);
            });

            const winnerName = gameState.playerNames[winnerIdx] || `${winnerIdx + 1}P`;
            document.getElementById('final-winner').textContent = currentLang === 'ko' || currentLang === 'ja' || currentLang === 'zh' ? `${winnerName}${i18n[currentLang].winTxt}` : `${winnerName}${i18n[currentLang].winTxt}`;
            showModal('modal-final');
        }

        function updateHUDScore() {
            const list = document.getElementById('score-list');
            list.innerHTML = '';
            gameState.scores.forEach((sc, idx) => {
                const isTurn = idx + 1 === gameState.currentPlayer;
                list.innerHTML += `<li class="flex justify-between ${isTurn ? 'text-green-700 font-extrabold' : ''}"><span>${idx + 1}P</span> <span>${sc.toLocaleString()}</span></li>`;
            });
        }

        function clearMapMarkers() {
            if (map.hasLayer(labelLayer)) map.removeLayer(labelLayer);
            mapMarkers.forEach(m => map.removeLayer(m));
            mapMarkers = [];
            if (mapPolyline) { map.removeLayer(mapPolyline); mapPolyline = null; }
        }

        function showModal(id) {
            const el = document.getElementById(id);
            el.classList.remove('hidden');
            setTimeout(() => el.classList.remove('opacity-0'), 10);
        }

        function hideModal(id) { document.getElementById(id).classList.add('hidden'); }

        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }
    </script>
</body>
</html>